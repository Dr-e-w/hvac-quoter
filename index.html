<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Tactical Pricer | Hagerstown</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .input-group:focus-within label { color: #1d4ed8; }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-12">

    <header class="bg-slate-900 text-white py-6 mb-8 shadow-md">
        <div class="max-w-xl mx-auto px-4 flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-tight">HVAC PRICER <span class="text-blue-400">v2.1</span></h1>
                <p class="text-xs text-slate-400 uppercase tracking-widest">Hagerstown Internal Tool</p>
            </div>
            <div class="text-right">
                <span class="bg-blue-500/10 text-blue-400 text-[10px] font-bold py-1 px-2 rounded border border-blue-400/20">LIVE SYNC ACTIVE</span>
            </div>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4">
        <form id="quoteForm" class="space-y-6">
            
            <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-sm font-black text-slate-400 uppercase mb-4 flex items-center">
                    <span class="mr-2">01</span> Customer Details
                </h2>
                <div class="space-y-4">
                    <div class="input-group">
                        <label class="block text-xs font-bold uppercase mb-1 ml-1 text-slate-500">Full Name</label>
                        <input type="text" id="customerName" required placeholder="John Doe" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    </div>
                    <div class="input-group">
                        <label class="block text-xs font-bold uppercase mb-1 ml-1 text-slate-500">Service Address</label>
                        <input type="text" id="address" required placeholder="123 Main St, Hagerstown" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    </div>
                </div>
            </section>

            <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-sm font-black text-slate-400 uppercase mb-4 flex items-center">
                    <span class="mr-2">02</span> Equipment & Parts
                </h2>
                
                <div class="space-y-4">
                    <div id="standardSection">
                        <label class="block text-xs font-bold uppercase mb-1 ml-1 text-slate-500">Base System</label>
                        <select id="baseEquipment" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" onchange="calculateTotal()">
                            <option value="0">-- Select From Book --</option>
                            <option value="4500">Standard AC (14 SEER) - $4,500</option>
                            <option value="6200">Heat Pump (16 SEER) - $6,200</option>
                            <option value="8500">High Efficiency Duel Fuel - $8,500</option>
                        </select>
                    </div>

                    <div class="pt-2">
                        <button type="button" onclick="toggleCustom()" class="text-blue-600 text-xs font-bold uppercase hover:underline">+ Add Custom Equipment/Materials</button>
                    </div>

                    <div id="customArea" class="hidden space-y-3 p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <input type="text" id="customDesc" placeholder="Description (e.g. Specialized Filter Rack)" class="w-full p-2 border rounded-lg text-sm">
                        <input type="number" id="customCost" placeholder="Custom Cost ($)" class="w-full p-2 border rounded-lg text-sm" oninput="calculateTotal()">
                    </div>
                </div>
            </section>

            <section class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                <h2 class="text-sm font-black text-slate-400 uppercase mb-4 flex items-center">
                    <span class="mr-2">03</span> Labor & Profit
                </h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 ml-1 text-slate-500">Labor Fees ($)</label>
                        <input type="number" id="laborFee" value="0" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" oninput="calculateTotal()">
                    </div>
                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 ml-1 text-slate-500">Margin (%)</label>
                        <input type="number" id="margin" value="0" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none" oninput="calculateTotal()">
                    </div>
                </div>
            </section>

            <div class="bg-slate-900 p-8 rounded-2xl shadow-xl text-center">
                <p class="text-slate-400 text-xs font-bold uppercase mb-2">Total Calculated Price</p>
                <div class="text-4xl font-black text-white mb-6">$<span id="displayTotal">0.00</span></div>
                
                <button type="submit" id="submitBtn" class="w-full bg-blue-500 hover:bg-blue-400 text-white font-black py-4 rounded-xl transition-all shadow-[0_0_20px_rgba(59,130,246,0.4)] uppercase tracking-widest">
                    Confirm & Sync to Logs
                </button>
            </div>
        </form>
    </main>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwwPmfzN-P8oRbBaZe0I0u_CqtHP8kGHIQEOqkQflkK4jnEHPH-r30aDF7tbpR7Epi_/exec';

        function toggleCustom() {
            document.getElementById('customArea').classList.toggle('hidden');
        }

        function calculateTotal() {
            const base = parseFloat(document.getElementById('baseEquipment').value) || 0;
            const custom = parseFloat(document.getElementById('customCost').value) || 0;
            const labor = parseFloat(document.getElementById('laborFee').value) || 0;
            const marginPercent = parseFloat(document.getElementById('margin').value) || 0;

            const subtotal = base + custom + labor;
            // Calculation: Subtotal / (1 - Margin%)
            const total = marginPercent > 0 ? subtotal / (1 - (marginPercent / 100)) : subtotal;

            document.getElementById('displayTotal').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            return total.toFixed(2);
        }

        document.getElementById('quoteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const finalTotal = calculateTotal();
            
            btn.innerText = "UPLOADING...";
            btn.disabled = true;

            const payload = {
                customerName: document.getElementById('customerName').value,
                address: document.getElementById('address').value,
                equipmentBase: document.getElementById('baseEquipment').options[document.getElementById('baseEquipment').selectedIndex].text,
                customDetails: document.getElementById('customDesc').value,
                customCost: document.getElementById('customCost').value,
                labor: document.getElementById('laborFee').value,
                margin: document.getElementById('margin').value,
                totalPrice: finalTotal
            };

            try {
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(payload)
                });

                alert("SYNCED SUCCESSFULLY");
                document.getElementById('quoteForm').reset();
                calculateTotal();
            } catch (error) {
                alert("SYNC ERROR - CHECK CONNECTION");
            } finally {
                btn.innerText = "Confirm & Sync to Logs";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
