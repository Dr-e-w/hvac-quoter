<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Tactical Pricer | Hagerstown HQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-12 font-sans">

    <header class="bg-blue-900 text-white py-8 mb-8">
        <div class="max-w-xl mx-auto px-4">
            <h1 class="text-2xl font-black tracking-tight italic">HAGERSTOWN HVAC <span class="text-blue-400">v2.1</span></h1>
            <p class="text-sm text-blue-200 font-bold uppercase tracking-widest">Pricing & Quoting Tool</p>
        </div>
    </header>

    <main class="max-w-xl mx-auto px-4">
        <form id="quoteForm" class="space-y-6">
            
            <section class="bg-white p-6 rounded-2xl card-shadow border border-gray-200">
                <h2 class="text-xs font-black text-blue-900 uppercase mb-4 flex items-center tracking-widest">
                    <span class="bg-blue-100 text-blue-600 w-6 h-6 rounded-full flex items-center justify-center mr-2">1</span> 
                    Customer Details
                </h2>
                <div class="grid gap-4">
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Full Name</label>
                        <input type="text" id="customerName" required placeholder="John Poyle" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Service Address</label>
                        <input type="text" id="address" required placeholder="123 Main St, Hagerstown" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>
            </section>

            <section class="bg-white p-6 rounded-2xl card-shadow border border-gray-200">
                <h2 class="text-xs font-black text-blue-900 uppercase mb-4 flex items-center tracking-widest">
                    <span class="bg-blue-100 text-blue-600 w-6 h-6 rounded-full flex items-center justify-center mr-2">2</span> 
                    Equipment & Parts
                </h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Base System Select</label>
                        <select id="baseEquipment" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none" onchange="updateMath()">
                            <option value="0">-- Select From Book --</option>
                            <option value="4500">Standard AC (14 SEER) - $4,500</option>
                            <option value="6200">Heat Pump (16 SEER) - $6,200</option>
                            <option value="8500">Dual Fuel System - $8,500</option>
                        </select>
                    </div>

                    <div class="pt-2">
                        <button type="button" onclick="toggleCustom()" class="text-blue-600 text-[11px] font-black uppercase hover:text-blue-800 transition-colors">+ Add Custom Item/Material</button>
                    </div>

                    <div id="customArea" class="hidden space-y-3 p-4 bg-blue-50 rounded-xl border border-blue-100">
                        <input type="text" id="customDesc" placeholder="Item Description" class="w-full p-3 bg-white border rounded-lg text-sm">
                        <input type="number" id="customCost" placeholder="Item Cost ($)" class="w-full p-3 bg-white border rounded-lg text-sm" oninput="updateMath()">
                    </div>
                </div>
            </section>

            <section class="bg-white p-6 rounded-2xl card-shadow border border-gray-200">
                <h2 class="text-xs font-black text-blue-900 uppercase mb-4 flex items-center tracking-widest">
                    <span class="bg-blue-100 text-blue-600 w-6 h-6 rounded-full flex items-center justify-center mr-2">3</span> 
                    Labor & Profit
                </h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Labor Fee ($)</label>
                        <input type="number" id="laborFee" value="0" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none" oninput="updateMath()">
                    </div>
                    <div>
                        <label class="block text-[10px] font-black uppercase text-gray-400 mb-1 ml-1">Margin (%)</label>
                        <input type="number" id="margin" value="0" class="w-full p-4 bg-gray-50 border border-gray-200 rounded-xl outline-none" oninput="updateMath()">
                    </div>
                </div>
            </section>

            <div class="bg-blue-900 p-8 rounded-3xl shadow-2xl text-center border-4 border-blue-800">
                <p class="text-blue-300 text-[10px] font-black uppercase tracking-[0.2em] mb-2">Total Quoted Price</p>
                <div class="text-5xl font-black text-white mb-8 tracking-tighter">$<span id="displayTotal">0.00</span></div>
                
                <button type="submit" id="submitBtn" class="w-full bg-blue-500 hover:bg-blue-400 text-white font-black py-5 rounded-2xl transition-all shadow-lg uppercase tracking-widest text-sm">
                    Confirm & Sync to HQ Logs
                </button>
            </div>
        </form>
    </main>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwwPmfzN-P8oRbBaZe0I0u_CqtHP8kGHIQEOqkQflkK4jnEHPH-r30aDF7tbpR7Epi_/exec';

        function toggleCustom() {
            const area = document.getElementById('customArea');
            area.classList.toggle('hidden');
        }

        function updateMath() {
            const base = parseFloat(document.getElementById('baseEquipment').value) || 0;
            const custom = parseFloat(document.getElementById('customCost').value) || 0;
            const labor = parseFloat(document.getElementById('laborFee').value) || 0;
            const marginPercent = parseFloat(document.getElementById('margin').value) || 0;

            const subtotal = base + custom + labor;
            // Standard HVAC Margin Calculation: Cost / (1 - Margin%)
            const total = marginPercent > 0 && marginPercent < 100 ? subtotal / (1 - (marginPercent / 100)) : subtotal;

            document.getElementById('displayTotal').innerText = total.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
            return total.toFixed(2);
        }

        document.getElementById('quoteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const finalTotal = updateMath();
            
            btn.innerText = "SENDING TO LOGS...";
            btn.disabled = true;

            const payload = {
                customerName: document.getElementById('customerName').value,
                address: document.getElementById('address').value,
                totalPrice: finalTotal,
                margin: document.getElementById('margin').value + "%",
                labor: "$" + document.getElementById('laborFee').value,
                equipmentBase: document.getElementById('baseEquipment').options[document.getElementById('baseEquipment').selectedIndex].text,
                customDetails: document.getElementById('customDesc').value || "None"
            };

            try {
                // Fetch to Google Apps Script
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    body: JSON.stringify(payload)
                });

                alert("SYNC SUCCESSFUL: Data added to HQ Logs.");
                document.getElementById('quoteForm').reset();
                updateMath();
            } catch (error) {
                alert("SYNC FAILED: Check internet connection.");
            } finally {
                btn.innerText = "Confirm & Sync to HQ Logs";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
