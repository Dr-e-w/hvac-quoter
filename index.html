<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HVAC Pricer v2.0 | Hagerstown</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <div class="max-w-2xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-blue-700 p-6 text-white text-center">
            <h1 class="text-2xl font-bold italic uppercase tracking-wider">HVAC Pricer v2.0</h1>
            <p class="text-blue-100 text-sm">Internal Quoting Tool - Hagerstown HQ</p>
        </div>

        <form id="quoteForm" class="p-6 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Technician Name</label>
                    <input type="text" id="techName" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">Customer Zip Code</label>
                    <input type="text" id="customerZip" required class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <hr>

            <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                <label class="flex items-center cursor-pointer">
                    <input type="checkbox" id="customToggle" class="w-5 h-5 text-blue-600 rounded" onchange="toggleCustomFields()">
                    <span class="ml-3 font-semibold text-blue-900">Add Custom Equipment / Not in Book</span>
                </label>

                <div id="customFields" class="hidden mt-4 space-y-4">
                    <input type="text" id="customName" placeholder="Unit Brand & Model #" class="w-full p-3 border rounded-lg">
                    <input type="number" id="customPrice" placeholder="Manual Price ($)" class="w-full p-3 border rounded-lg">
                </div>

                <div id="standardFields" class="mt-4">
                    <label class="block text-sm font-bold text-gray-700 mb-1">Select System from Book</label>
                    <select id="modelSelect" class="w-full p-3 border rounded-lg">
                        <option value="1.5 Ton Standard Heat Pump - $8,500">1.5 Ton Standard Heat Pump - $8,500</option>
                        <option value="2.0 Ton High Efficiency - $10,200">2.0 Ton High Efficiency - $10,200</option>
                        <option value="Dual Fuel System - $12,500">Dual Fuel System - $12,500</option>
                    </select>
                </div>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl transition-all transform active:scale-95 shadow-lg">
                GENERATE QUOTE & SYNC TO OFFICE
            </button>
        </form>
    </div>

    <script>
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwwPmfzN-P8oRbBaZe0I0u_CqtHP8kGHIQEOqkQflkK4jnEHPH-r30aDF7tbpR7Epi_/exec';

        function toggleCustomFields() {
            const isCustom = document.getElementById('customToggle').checked;
            document.getElementById('customFields').classList.toggle('hidden', !isCustom);
            document.getElementById('standardFields').classList.toggle('hidden', isCustom);
        }

        document.getElementById('quoteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const isCustom = document.getElementById('customToggle').checked;
            
            // Set loading state
            btn.innerText = "SYNCING DATA...";
            btn.disabled = true;

            const payload = {
                techName: document.getElementById('techName').value,
                customerZip: document.getElementById('customerZip').value,
                isCustom: isCustom,
                // If custom is checked, use custom name; otherwise, split the dropdown value to get the name
                equipmentName: isCustom ? document.getElementById('customName').value : document.getElementById('modelSelect').value.split(' - ')[0],
                totalPrice: isCustom ? document.getElementById('customPrice').value : document.getElementById('modelSelect').value.split(' - ')[1]
            };

            try {
                // 'no-cors' is necessary for Google Apps Script to work from a web front-end
                await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                alert("Success! The office has received the quote log.");
                document.getElementById('quoteForm').reset();
                toggleCustomFields(); // Reset field visibility
            } catch (error) {
                console.error("Sync Error:", error);
                alert("The sync failed. Check your internet connection.");
            } finally {
                btn.innerText = "GENERATE QUOTE & SYNC TO OFFICE";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
